<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="manager.css">
</head>

<body>
    <div class="container" style="width: 100%;display: flex;position: relative;">
        <div class="col2" style="width: 20%;">
            <button style="width: 100%;height: 200px;" onclick=dept()>Quan li khieu nai</button>
            <button style="width: 100%;height: 200px;" onclick=ticket()>Quan li phong ban</button>
        </div>
        <div class="col2" id="dept" style="width: 80%;top:0%;height: 0%;height: 800px;">
            <div class="searchbar">
                <input type="text" class="searchinput">
                <button>Search</button>
                <button onclick=showaddticket()>Create</button>
            </div>
            <div class="ticketlist" style="overflow: scroll;">
                <table id="tickettable">
                    <tr>
                        <th>Ticket ID</th>
                        <th>Phong ban</th>
                        <th>So dt KH</th>
                        <th>Y kien kh</th>
                        <th>thoi gian tiep nhan</th>
                        <th>noi dung xu ly</th>
                        <th>trang thai xu li</th>
                        <th>thoi gian xu li</th>
                    </tr>
                </table>
            </div>
        </div>
        <div class="col2" id="addticket"
            style="width: 80%;top:0%;height: 0%;height: 800px;display: none">
                <div class="form-group">
                    <label>Department ID</label>
                    <input type="text" class="form-control" id="deptid">
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="text" class="form-control" id="phone">
                </div>
                <div class="form-group">
                    <label>Opinion</label>
                    <input type="text" class="form-control" id="opinion">
                </div>
                <div class="form-group">
                    <label>Receitime</label>
                    <input type="date" name="" id="time">
                </div>
                <button onclick=addticket()>Submit</button>
    
        </div>
        <div class="col2" id="ticket"
            style="width: 80%;top:0%;height: 0%;height: 800px;display: none">

        </div>
    </div>
    <script>
        loadticketdata()
        function loadticketdata() {
            var element = document.getElementById("tickettable")
            fetch("http://localhost:8081/api/alltickets")
                .then(res => {
                    return res.json()
                }).then(data => {
                    for (var i = 0; i < data.length; i++) {
                        var record = data[i];
                        element.innerHTML += `<tr>
                        <td>${record['ticketid']}</td>
                        <td>${record['deptname']}</td>
                        <td>${record['phonenumber']}</td>
                        <td>${record['customeropinion']}</td>
                        <td>${record['timereiceive']}</td>
                        <td>${record['answer']}</td>
                        <td>${record['processingstatus']}</td>
                        <td>${record['processingtime']}</td>
                    </tr>`
                    }
                })
        }
        function dept() {
            document.getElementById("dept").style.display = "block";
            document.getElementById("ticket").style.display = "none";
            document.getElementById("addticket").style.display="none"
        }
        function ticket() {
            document.getElementById("dept").style.display = "none";
            document.getElementById("ticket").style.display = "block";
            document.getElementById("addticket").style.display="none"
        }
        function showaddticket(){
            document.getElementById("dept").style.display = "none";
            document.getElementById("ticket").style.display = "none";
            document.getElementById("addticket").style.display="block"
        }
        function addticket(){
            var deptid= document.getElementById("deptid").value;
            var phone = document.getElementById("phone").value;
            var opinion = document.getElementById("opinion").value;
            var time=document.getElementById("time").value
            var xhttp = new XMLHttpRequest();
            
            xhttp.onreadystatechange = function () {
                if (this.status == 200) {
                    location.reload()
                }
                else {
                    var data = xhttp.response
                    if(data['status']=="0")alert(data["message"])
                }
            };
            xhttp.open("POST", "http://localhost:8081/api/createticket", true);
            xhttp.setRequestHeader("Content-type", "application/json");
            xhttp.responseType = "json";
            xhttp.send(JSON.stringify({ deptid: Number(deptid),phonenumber:String(phone), customeropinion: String(opinion),timereiceive:String(time) }));      
        }
    </script>
</body>

</html>